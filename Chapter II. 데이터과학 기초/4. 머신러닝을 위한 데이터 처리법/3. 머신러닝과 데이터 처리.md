# 3. 머신러닝과 데이터 처리 🧹

## 목차 📑

### 1. 결측치와 이상치 개념
- [1.1 결측치란?](#결측치란-) ❓
- [1.2 이상치란?](#이상치란-) ⚠️

### 2. 결측치 처리하기
- [2.1 결측치 확인](#결측치-확인-) 🔍
- [2.2 결측치 처리 방법](#결측치-처리-방법-) 🛠️
  - [수집](#수집)
  - [대체](#대체)
  - [제거](#제거)
- [2.3 결측치 대체 기법](#결측치-대체-기법-) 🔄
- [2.4 결측치 제거 방법](#결측치-제거-방법-) 🗑️
- [2.5 실습 예시](#결측치-실습-예시-) 📝

### 3. 이상치 처리하기
- [3.1 이상치 확인](#이상치-확인-) 🔍
- [3.2 이상치 처리 방법](#이상치-처리-방법-) 🛠️
  - [대체](#이상치-대체)
  - [변수화](#이상치-변수화)
  - [제거](#이상치-제거)
- [3.3 이상치 대체 및 변수화](#이상치-대체-및-변수화-) 🔄
- [3.4 실습 예시](#이상치-실습-예시-) 📝

---

## 결측치란? ❓

**결측치**란 데이터셋 내 일부 값이 누락된 상태를 의미한다. 결측치는 데이터 분석 과정에서 오류를 유발하거나 결과 해석을 왜곡할 수 있으므로 반드시 적절한 처리가 필요하다. 결측치 처리 방식에 따라 분석 결과가 달라질 수 있으므로, 분석가의 판단과 데이터의 특성을 모두 고려해야 한다.

### 예시

```python
import pandas as pd

# 결측치가 포함된 데이터프레임 생성
data = {
    '이름': ['가영', '민준', '서연', '지후'],
    '점수': [85, None, 90, None],
    '출석': [True, True, None, False]
}
df = pd.DataFrame(data)
print(df)
```

**출력 예시:**
```
    이름    점수    출석
0  가영  85.0   True
1  민준   NaN   True
2  서연  90.0    NaN
3  지후   NaN  False
```

### 주의사항

- 결측치의 존재 여부는 데이터 분석 전 반드시 확인해야 한다.
- 결측치 처리 방법에 따라 분석 결과가 크게 달라질 수 있다.

---

## 이상치란? ⚠️

**이상치**란 데이터 분포에서 다른 값들과 현저히 동떨어진 값을 의미한다. 이상치는 분석 결과에 편향을 일으키거나, 머신러닝 모델의 성능을 저하시킬 수 있다. 따라서 이상치의 탐지와 적절한 처리가 중요하다.

### 예시

```python
import numpy as np
import matplotlib.pyplot as plt

# 이상치가 포함된 데이터 생성
values = [10, 12, 11, 13, 100, 12, 11, 14]
plt.boxplot(values)
plt.title('이상치 시각화')
plt.show()
```

### 주의사항

- 이상치가 반드시 오류는 아니며, 도메인 지식에 따라 처리 여부를 결정해야 한다.
- 이상치 제거 시 데이터 손실이 발생할 수 있으므로 신중하게 판단해야 한다.

---

## 결측치 확인 🔍

결측치는 **pandas**의 `isnull()` 또는 `isna()` 메서드를 활용하여 확인할 수 있다. 각 열별 결측치 개수를 파악하면, 처리 전략을 세우는 데 도움이 된다.

### 예시

```python
import pandas as pd

df = pd.DataFrame({
    'A': [1, None, 3, None],
    'B': [4, 5, None, 7]
})

print(df.isnull().sum())
```

**출력 예시:**
```
A    2
B    1
dtype: int64
```

### 주의사항

- 결측치가 많은 열이나 행은 분석에서 제외하는 것이 바람직할 수 있다.

---

## 결측치 처리 방법 🛠️

결측치 처리에는 **수집**, **대체**, **제거**의 세 가지 주요 방법이 있다.

### 수집

결측된 데이터를 추가로 확보할 수 있다면, 가장 바람직한 방법이다. 그러나 현실적으로 추가 수집이 불가능하거나 비용 및 시간이 과도하게 소요되는 경우가 많다.

### 대체

결측치를 다른 값으로 대체하는 방법이다. 대표적으로 평균, 중앙값, 최빈값, 예측값 등으로 대체할 수 있다. 데이터가 적을 때 주로 사용되며, 대체 방법에 따라 데이터에 편향이 생길 수 있다.

### 제거

결측치가 포함된 행 또는 열을 삭제하는 방법이다. 데이터가 충분히 많거나, 결측치가 집중된 열/행이 분석에 큰 의미가 없을 때 사용한다.

---

## 결측치 대체 기법 🔄

결측치 대체는 데이터의 특성에 따라 다양한 기법이 적용된다.

- **행 정보 기반 대체**: 같은 행의 다른 변수 값을 활용하여 결측치를 추정한다.
- **열 정보 기반 대체**: 같은 열의 다른 값(예: 시계열 데이터의 앞뒤 값)으로 결측치를 추정한다.
- **통계적 대체**: 평균, 중앙값, 최빈값 등 통계량으로 대체한다.
- **모델 기반 대체**: KNN, SVM, MICE 등 머신러닝 기법을 활용하여 결측치를 예측한다.

### 예시

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    '월': ['1월', '2월', '3월', '4월'],
    '평균기온': [2.5, np.nan, 10.1, 15.3],
    '최고기온': [8.0, 11.2, 18.5, 25.0]
})

# 평균값으로 결측치 대체
mean_temp = df['평균기온'].mean()
df['평균기온'] = df['평균기온'].fillna(mean_temp)
print(df)
```

**출력 예시:**
```
    월   평균기온   최고기온
0  1월   2.5   8.0
1  2월   9.3  11.2
2  3월  10.1  18.5
3  4월  15.3  25.0
```

### 주의사항

- 대체 방법 선택 시 데이터의 분포와 특성을 반드시 고려해야 한다.
- 모델 기반 대체는 결측치가 많은 경우에 효과적이나, 복잡도가 높을 수 있다.

---

## 결측치 제거 방법 🗑️

결측치가 많은 행 또는 열을 삭제하는 방법이다. 분석에 큰 의미가 없거나, 결측치가 데이터의 대다수를 차지할 때 주로 사용된다.

### 예시

```python
import pandas as pd

df = pd.DataFrame({
    '도시': ['서울', '부산', '대구', '광주'],
    '강수량': [55, None, 70, None],
    '기온': [13.2, 15.1, None, 16.5]
})

# 결측치가 포함된 행 삭제
df_clean = df.dropna()
print(df_clean)
```

**출력 예시:**
```
    도시   강수량    기온
0  서울  55.0  13.2
```

### 주의사항

- 데이터가 충분하지 않은 경우, 행/열 삭제는 정보 손실을 유발할 수 있다.

---

## 결측치 실습 예시 📝

실제 데이터셋에서 결측치를 처리하는 과정은 다음과 같다.

### 예시

```python
import pandas as pd

# 가상의 승객 데이터
data = {
    '승객ID': [1, 2, 3, 4],
    '나이': [28, None, 35, None],
    '요금': [72.5, 53.1, None, 8.0]
}
df = pd.DataFrame(data)

# 결측치 확인
print(df.isnull().sum())

# 나이 결측치는 평균으로, 요금 결측치는 중앙값으로 대체
df['나이'] = df['나이'].fillna(df['나이'].mean())
df['요금'] = df['요금'].fillna(df['요금'].median())
print(df)
```

**출력 예시:**
```
승객ID    0
나이      2
요금      1
dtype: int64

   승객ID    나이    요금
0      1  28.0  72.50
1      2  31.5  53.10
2      3  35.0  53.10
3      4  31.5   8.00
```

### 주의사항

- 결측치 처리 후 데이터의 분포가 크게 변하지 않았는지 확인해야 한다.

---

## 이상치 확인 🔍

이상치는 **박스플롯(Box Plot)**, **산점도(Scatter Plot)** 등 시각화 기법이나, 통계적 방법(예: IQR, Z-score)으로 탐지할 수 있다.

### 예시

```python
import pandas as pd
import matplotlib.pyplot as plt

df = pd.DataFrame({'점수': [70, 75, 80, 85, 90, 200]})
plt.boxplot(df['점수'])
plt.title('점수의 이상치 탐지')
plt.show()
```

### 주의사항

- 이상치가 반드시 오류는 아니며, 실제 특이값일 수 있으므로 도메인 지식과 함께 해석해야 한다.

---

## 이상치 처리 방법 🛠️

이상치 처리에는 **대체**, **변수화**, **제거**의 세 가지 방법이 있다.

### 이상치 대체

이상치를 평균, 중앙값 등 통계값이나 예측값으로 대체하는 방법이다. 데이터가 적을 때 주로 사용된다.

### 이상치 변수화

이상치를 별도의 범주(예: "30,000 이상" 등)로 변환하여 새로운 변수로 처리한다. 오류가 아닌 특이값을 보존하고 싶을 때 활용한다.

### 이상치 제거

오류에 의한 이상치인 경우, 해당 데이터를 삭제한다. 데이터가 충분히 많을 때 주로 사용된다.

---

## 이상치 대체 및 변수화 🔄

이상치 대체는 열 또는 행의 정보를 활용하거나, 변수 간의 관계를 이용하여 수행할 수 있다. 변수화는 이상치 값을 범주형 데이터로 변환하는 방식이다.

### 예시

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    '연봉': [25000, 27000, 30000, 120000, 26000]
})

# 10만 이상은 '10만 이상'으로 변수화
df['연봉_범주'] = df['연봉'].apply(lambda x: '10만 이상' if x >= 100000 else '10만 미만')
print(df)
```

**출력 예시:**
```
      연봉    연봉_범주
0  25000  10만 미만
1  27000  10만 미만
2  30000  10만 미만
3 120000  10만 이상
4  26000  10만 미만
```

### 주의사항

- 변수화 시 실제 데이터의 의미가 왜곡되지 않도록 주의해야 한다.
- 대체 또는 변수화 방법은 데이터의 목적과 특성에 따라 달라진다.

---

## 이상치 실습 예시 📝

실제 데이터셋에서 이상치를 처리하는 과정은 다음과 같다.

### 예시

```python
import pandas as pd
import numpy as np

# 가상의 상품 가격 데이터
df = pd.DataFrame({'상품명': ['A', 'B', 'C', 'D', 'E'], '가격': [1200, 1300, 1250, 50000, 1280]})

# 가격이 1만 이상인 경우 중앙값으로 대체
median_price = df.loc[df['가격'] < 10000, '가격'].median()
df['가격'] = df['가격'].apply(lambda x: median_price if x > 10000 else x)
print(df)
```

**출력 예시:**
```
  상품명    가격
0   A  1200
1   B  1300
2   C  1250
3   D  1250
4   E  1280
```

### 주의사항

- 이상치 처리 후 데이터의 분포와 통계량이 적절한지 반드시 확인해야 한다.

---

## 요약

- **결측치**와 **이상치**는 데이터 분석의 신뢰성과 정확성에 큰 영향을 미치므로, 적절한 탐지와 처리가 필수적이다.
- 결측치 처리 방법에는 **수집**, **대체**, **제거**가 있으며, 이상치 처리 방법에는 **대체**, **변수화**, **제거**가 있다.
- 처리 방법 선택 시 데이터의 특성과 분석 목적을 반드시 고려해야 한다.
- 처리 후에는 데이터의 분포와 통계량이 적절한지 항상 검토해야 한다.

---