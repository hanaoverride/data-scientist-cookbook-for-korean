# 3. 데이터 정제: 결측치와 이상치 처리

## 목차
- [3. 데이터 정제: 결측치와 이상치 처리](#3-데이터-정제-결측치와-이상치-처리)
  - [목차](#목차)
  - [데이터 정제(Cleaning)란?](#데이터-정제cleaning란)
  - [결측치 (Missing Values) 처리하기](#결측치-missing-values-처리하기)
    - [결측치, 왜 발생할까?](#결측치-왜-발생할까)
    - [결측치 처리 전략](#결측치-처리-전략)
  - [이상치 (Outliers) 탐지 및 처리](#이상치-outliers-탐지-및-처리)
    - [이상치 탐지 방법](#이상치-탐지-방법)
    - [이상치 처리 전략](#이상치-처리-전략)
  - [데이터 연결(Merge/Join) 시 주의사항](#데이터-연결mergejoin-시-주의사항)

---

## 데이터 정제(Cleaning)란?

**데이터 정제** 또는 **데이터 클리닝**은 원본 데이터(Raw Data)에 포함된 **부정확하거나, 불완전하거나, 관련이 없거나, 일관되지 않은** 부분(결측치, 이상치, 오류 등)을 식별하고 수정하거나 제거하는 과정입니다.

"Garbage In, Garbage Out (쓰레기를 넣으면, 쓰레기가 나온다)"는 말처럼, 데이터 분석 프로젝트의 성공은 고품질의 깨끗한 데이터에서 시작됩니다. 데이터 분석가들은 종종 전체 업무 시간의 60~80%를 이 데이터 정제 과정에 사용합니다.

---

## 결측치 (Missing Values) 처리하기

**결측치**는 데이터셋에서 특정 값이 누락되어 비어있는 상태를 의미합니다. (Pandas에서는 `NaN` - Not a Number로 표시됨)

### 결측치, 왜 발생할까?

- 데이터 수집 과정에서의 오류 (예: 센서 고장)
- 사용자가 의도적으로 정보를 입력하지 않음 (예: 선택적 설문 항목)
- 데이터 통합 과정에서의 불일치

> **중요**: 결측치는 단순히 '값이 없음'이 아니라, 그 자체가 **의미 있는 정보**일 수 있습니다. 예를 들어, '재구매_일자' 열의 결측치는 '재구매를 하지 않은 고객'이라는 중요한 정보를 담고 있을 수 있습니다. 따라서 무작정 처리하기 전에, 결측이 발생한 원인을 먼저 파악해야 합니다.

### 결측치 처리 전략

| 처리 방법 | 설명 | 장점 | 단점 |
|---|---|---|---|
| **1. 제거 (Deletion)**  | 결측치가 포함된 행 또는 열 전체를 삭제합니다. | 간단하고 빠름. | 데이터 손실이 발생하며, 편향을 유발할 수 있음. |
| **2. 대치 (Imputation)**  | 결측치를 다른 값으로 채웁니다. | 데이터 손실을 막음. | 데이터의 실제 분포를 왜곡할 수 있음. |
| - **평균/중앙값 대치** | 숫자형 데이터의 경우, 전체 데이터의 평균 또는 중앙값으로 채웁니다. | 구현이 간단함. | 데이터의 분산을 줄이고, 이상치에 민감함(평균). |
| - **최빈값 대치** | 범주형 데이터의 경우, 가장 빈번하게 나타나는 값으로 채웁니다. | 구현이 간단함. | 특정 값에 대한 편향을 증가시킬 수 있음. |
| - **모델 기반 대치** | 다른 변수들을 기반으로, 머신러닝 모델(예: 회귀, k-NN)을 사용하여 결측치를 **예측**하여 채웁니다. | 더 정교하고 정확한 대치가 가능함. | 구현이 복잡하고, 계산 비용이 높음. |

---

## 이상치 (Outliers) 탐지 및 처리

**이상치**는 대부분의 다른 값들과는 극단적으로 다른, 비정상적인 값을 의미합니다. (예: '나이' 열에 있는 999, '월소득' 열에 있는 100억) 이상치는 분석 결과, 특히 평균과 같은 통계량을 심각하게 왜곡할 수 있습니다.

### 이상치 탐지 방법

1.  **시각화 활용**: **상자 그림(Box Plot)** 을 그려, 사분위수 범위를 벗어나는 점들을 시각적으로 확인하는 것이 가장 직관적이고 효과적입니다.
2.  **통계적 기법 (IQR, Z-score)** :
    - **IQR (Interquartile Range) 규칙**: `Q1 - 1.5 * IQR` 보다 작거나, `Q3 + 1.5 * IQR` 보다 큰 값을 이상치로 판단합니다. (Box Plot의 기본 원리)
    - **Z-score**: 데이터가 정규분포를 따른다고 가정할 때, 평균으로부터 표준편차의 몇 배나 떨어져 있는지를 측정하여, 보통 Z-score가 3 이상이거나 -3 이하인 값을 이상치로 판단합니다.

### 이상치 처리 전략

- **제거 (Deletion)** : 해당 이상치가 명백한 측정 오류나 입력 실수라고 확신할 수 있을 때 제거합니다.
- **변환 (Transformation)** : 로그 변환(`log()`)이나 제곱근 변환(`sqrt()`) 등을 통해 데이터의 분포를 조정하여 이상치의 영향을 줄입니다.
- **치환 (Replacement)** : 이상치를 상한(upper bound)이나 하한(lower bound) 값으로 대체합니다.
- **분리 (Binning)** : 연속형 데이터를 구간별로 나누어 범주형 데이터로 변환하여 이상치의 영향을 완화합니다.

---

## 데이터 연결(Merge/Join) 시 주의사항

여러 데이터 소스를 결합할 때는 데이터의 일관성을 해치지 않도록 주의해야 합니다.

- **키(Key) 값 확인**: 조인의 기준이 되는 키 열에 결측치나 중복값이 없는지, 데이터 타입이 동일한지 반드시 확인해야 합니다.
- **데이터 충돌**: 두 데이터셋에 동일한 이름의 열이 존재할 경우, 어떤 값을 남길지 명확한 규칙을 정해야 합니다. Pandas의 `merge` 함수는 자동으로 접미사(`_x`, `_y`)를 붙여 이를 구분해줍니다.
- **조인 방식 선택**: 분석의 목적에 따라 `inner`, `left`, `outer` 등 적절한 조인 방식을 신중하게 선택해야 합니다. 잘못된 조인은 데이터의 손실이나 왜곡을 유발할 수 있습니다.